<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="ejs.js"></script>

    <script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.4.1/firebase-firestore.js"></script>



    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDz9f-HDU9DWpRfu0b1YiRW8cYz7gCy_1Q",
            authDomain: "shopee-6ab15.firebaseapp.com",
            databaseURL: "https://shopee-6ab15.firebaseio.com",
            projectId: "shopee-6ab15",
            storageBucket: "shopee-6ab15.appspot.com",
            messagingSenderId: "238081860305"
        };
        firebase.initializeApp(config);

        // Initialize Cloud Firestore through Firebase
        var db = firebase.firestore();

        // Disable deprecated features
        db.settings({
            timestampsInSnapshots: true
        });




    </script>

    <title></title>
</head>

<body>
    <ons-page>
        <ons-toolbar>
            <div class="left">
                <ons-toolbar-button icon="fa-shopping-bag"></ons-toolbar-button>
            </div>
            <div class="center" id="appname">#</div>
            <div class="right">
                <ons-toolbar-button icon="md-help"></ons-toolbar-button>
            </div>
        </ons-toolbar>
        <ons-tabbar swipeable position="auto">
            <ons-tab page="tab1.html" label="Home" icon="ion-home, material:md-home" badge="7" active>
            </ons-tab>
            <ons-tab page="tab2.html" label="Cart" icon="fa-shopping-bag" active-icon="fa-shopping-bag">
            </ons-tab>
            <ons-tab page="tab3.html" label="Shopping" icon="fa-heart" active-icon="fa-heart">
            </ons-tab>
        </ons-tabbar>

        <template id="tab1.html">
            <ons-page id="Tab1">
                <p style="text-align: center;">
                    <input type="search" value="" placeholder="Search" class="search-input search-input--material" style="width: 280px;">
                </p>



                <ons-carousel swipeable auto-scroll overscrollable id="carousel" style="height: 300px;">

                    <ons-carousel-item id="carousel1" style="background: url('imges/1.jpg')no-repeat center;background-size: contain;">
                        <div style="text-align: center; font-size: 30px; margin-top: 20px; color: #fff;">

                        </div>
                    </ons-carousel-item>
                    <ons-carousel-item id="carousel2" style="background: url('imges/2.jpg')no-repeat center;background-size: contain;">
                        <div style="text-align: center; font-size: 30px; margin-top: 20px; color: #fff;">

                        </div>
                    </ons-carousel-item>
                    <ons-carousel-item id="carousel3" style="background: url('imges/3.jpg')no-repeat center;background-size: contain;">
                        <div style="text-align: center; font-size: 30px; margin-top: 20px; color: #fff;">

                        </div>
                    </ons-carousel-item>
                </ons-carousel>



                <div id="icons"></div>

                <script id="icon_template" type="text/template">
             <ons-row style="height:120px" vertical-align="center">
                <% categories.forEach(function(category){%>
                <ons-col style="background:#FFFF99	;" width="33%">
                    <p style="text-align: center; margin: 10px;">
                        <ons-icon size="60px" icon="<%= category.icon %>"></ons-icon>
                    </p>
                    <p style="text-align: center; margin: 10px;" id="icon1_text">
                        <%= category.name %>
                    </p>
                </ons-col>
                <%});%>
            </ons-row>
                </script>
            </ons-page>

        </template>

        <template id="tab2.html">
            <ons-page id="Tab2">
                <ons-list>
                    <ons-list-header>Shopping Cart</ons-list-header>

                    <div id="carts"></div>
                    <script id="carts_template" type="text/template">
                      <% cart.forEach(function(cart){%>  
                    <ons-list-item>
                      <div class="left">
                        <img class="list-item__thumbnail" src="<%= cart.photo %>">
                      </div>
                      <div class="center">
                        <span class="list-item__title"><%= cart.itemname %></span>
                        <span class="list-item__subtitle" style="color: blue"><%= cart.price %></span>
                      </div>
                      <div class="right">
                        <p style="text-align: center; margin: 10px;">
                          <ons-icon style="color: grey" size="30px" icon="md-delete"></ons-icon>
                        </p>
                      </div>
                    </ons-list-item>
                    <%});%>
            
                  </script>
                </ons-list>
                <p style="text-align: center; margin: 10px;">
                    <ons-button modifier="large">PROCEED TO PAY</ons-button>
                </p>
            </ons-page>
        </template>





        <template id="tab3.html">
            <ons-page id="Tab3">
                <ons-list>
                    <ons-list-header>Shop</ons-list-header>
                    <div id="products"></div>
                    <script id="products_template" type="text/template">
                              <% cart.forEach(function(cart){%>  
                            <ons-list-item>
                              <div class="left">
                                <img class="list-item__thumbnail" src="<%= product.photo %>">
                              </div>
                
            </ons-page>
        </template>




        <script>
            getHomeData();
            document.addEventListener('prechange', function (event) {
                if (event.index == 0) {
                    console.log('Home clicked');
                    // get data for home screen



                } else if (event.index == 1) {
                    console.log('Cart clicked');
                    // get data for cart screen
                    getCartData();

                }

                else if (event.index == 2) {
                    console.log('products clicked');
                    // get data for cart screen
                    getAllProduct();

                }


            });

            function getHomeData() {
                var docRef = db.collection("UI").doc("home"); // ผ่าน UI ผ่าน DOC HOME
                docRef.get().then(function (doc) {
                    if (doc.exists) {
                        //Display Data ข้อมูลปกติจะใช้งานตรงนี้
                        console.log("Document data:", doc.data());
                        var data = doc.data();
                        $('#appname').html(data.appname);
                        var style = "background: url('imges/" + data.slides[0] + "')no-repeat center;background-size: contain;'";
                        $('#carousel1').attr('style', style);
                        var icon_template = $('#icon_template').html();
                        var html = ejs.render(icon_template, { categories: data.categories });
                        $('#icons').html(html);
                    } else {
                        // doc.data() will be undefined in this case
                        console.log("No such document!");
                    }
                }).catch(function (error) {
                    console.log("Error getting document:", error);
                });
            }


            function getCartData() {
                var docRef = db.collection("UI").doc("cart"); // ผ่าน UI ผ่าน DOC HOME
                docRef.get().then(function (doc) {
                    if (doc.exists) {
                        //Display Data ข้อมูลปกติจะใช้งานตรงนี้
                        console.log("Document data:", doc.data());
                        var data = doc.data();
                        var carts_template = $('#carts_template').html();
                        var html = ejs.render(carts_template, { cart: data.cart });
                        $('#carts').html(html);
                    } else {
                        // doc.data() will be undefined in this case
                        console.log("No such document!");
                    }
                }).catch(function (error) {
                    console.log("Error getting document:", error);
                });
            }

            function getAllProduct() {
                var allProductRef = db.collection("products").where("category", "==", "sport");
                allProductRef.get().then(function (querySnapshot) {
                    querySnapshot.forEach(function (doc) {
                        // doc.data() is never undefined for query doc snapshots
                        console.log(doc.id, " => ", doc.data());
                    });
                });

            }

            function addNewData() {
                // Add a new data .
                var data = {
                    pid: 10,
                    title: 'notebook',
                    price: 25000,
                    category: 'computer'
                }



                db.collection("products").add(data)
                .then(function (docRef) {
                    console.log("Document written with ID: ", docRef.id);
                })
                .catch(function (error) {
                        console.error("Error adding document: ", error);
                    });
            }







        </script>
</body>

</html>